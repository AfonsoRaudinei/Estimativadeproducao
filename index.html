<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Produ√ß√£o de Soja</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1B4332">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        :root {
            --green: #34C759;
            --green-dark: #1B4332;
            --green-light: #E8F5E9;
            --bg: #F2F2F7;
            --card: #FFF;
            --text: #1D1D1F;
            --text2: #8E8E93;
            --text3: #C7C7CC;
            --font: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
            --photo-size: 80px;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font); background: var(--bg); color: var(--text); font-size: 14px; }
        
        .header {
            background: linear-gradient(180deg, var(--green-dark), #14332B);
            padding: 10px 16px;
            text-align: center;
        }
        .header h1 { color: #FFF; font-size: 0.9rem; font-weight: 600; }
        
        .container { max-width: 420px; margin: 0 auto; padding: 6px 8px 70px; }
        
        .pdf-content { background: #FFF; }
        
        .card {
            background: var(--card);
            border-radius: 10px;
            margin-bottom: 6px;
            overflow: hidden;
            page-break-inside: avoid;
            break-inside: avoid;
        }
        
        .card-head {
            padding: 6px 10px 3px;
            font-size: 0.55rem;
            font-weight: 600;
            color: var(--text2);
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .card-body { padding: 4px 10px 8px; }
        
        .aviso {
            background: #FFFBEB;
            border-left: 3px solid #F59E0B;
            border-radius: 0 8px 8px 0;
            padding: 6px 10px;
            margin-bottom: 6px;
            page-break-inside: avoid;
            break-inside: avoid;
        }
        .aviso-title { font-size: 0.6rem; font-weight: 600; color: #B45309; }
        .aviso-text { font-size: 0.5rem; color: #92400E; line-height: 1.3; margin-top: 2px; }
        
        .comp-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .comp-inputs {
            padding-right: 6px;
        }
        
        .comp-results {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .result-box {
            background: var(--bg);
            border-radius: 8px;
            padding: 8px 10px;
            border: 1px solid #E5E5EA;
        }
        
        .result-box.highlight {
            background: var(--green-light);
            border-color: var(--green);
        }
        
        .result-box label {
            display: block;
            font-size: 0.5rem;
            color: var(--text2);
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 4px;
        }
        
        .result-box.highlight label {
            color: var(--green-dark);
            font-weight: 600;
        }
        
        .result-value {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text);
        }
        
        .result-box.highlight .result-value {
            color: var(--green-dark);
            font-size: 1.1rem;
        }
        
        .plant-card {
            background: #FAFAFA;
            border-radius: 8px;
            padding: 8px;
            margin-bottom: 6px;
            border: 1px solid #E5E5EA;
        }
        
        .plant-header {
            font-size: 0.55rem;
            font-weight: 600;
            color: var(--text);
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 6px;
            padding-bottom: 4px;
            border-bottom: 1px solid #E5E5EA;
        }
        
        .vagem-row {
            display: grid;
            grid-template-columns: auto 50px 40px;
            gap: 6px;
            align-items: center;
            margin-bottom: 4px;
        }
        
        .vagem-row:last-of-type {
            margin-bottom: 6px;
        }
        
        .vagem-row label {
            font-size: 0.5rem;
            color: var(--text2);
            margin: 0;
        }
        
        .vagem-row input {
            height: 28px;
            font-size: 0.75rem;
            text-align: center;
            font-weight: 600;
        }
        
        .vagem-result {
            font-size: 0.5rem;
            color: var(--green-dark);
            font-weight: 600;
            text-align: right;
        }
        
        .entrenos-row {
            margin: 6px 0;
            padding: 6px 0;
            border-top: 1px dashed #E5E5EA;
            border-bottom: 1px dashed #E5E5EA;
        }
        
        .entrenos-row label {
            font-size: 0.45rem;
            color: var(--text3);
            display: block;
            margin-bottom: 3px;
        }
        
        .entrenos-row input {
            width: 100%;
            height: 26px;
            font-size: 0.7rem;
            text-align: center;
        }
        
        .plant-total {
            padding-top: 4px;
            border-top: 1px solid #E5E5EA;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .plant-total-label {
            font-size: 0.5rem;
            color: var(--text2);
            font-weight: 500;
        }
        
        .plant-total-value {
            font-size: 0.8rem;
            color: var(--green-dark);
            font-weight: 700;
        }
        
        .add-plant-btn {
            width: 100%;
            height: 32px;
            border-radius: 8px;
            border: 1.5px dashed #D1D1D6;
            background: transparent;
            color: var(--text3);
            font-size: 0.6rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }
        
        .add-plant-btn:hover {
            border-color: var(--green);
            background: var(--green-light);
            color: var(--green-dark);
        }
        
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 4px; }
        .grid-2:last-child { margin-bottom: 0; }
        
        .field { min-width: 0; }
        
        label {
            display: block;
            font-size: 0.5rem;
            color: var(--text2);
            margin-bottom: 2px;
            text-transform: uppercase;
            letter-spacing: 0.2px;
        }
        
        input, textarea {
            width: 100%;
            height: 28px;
            background: var(--bg);
            border: none;
            border-radius: 6px;
            padding: 0 8px;
            font-size: 0.75rem;
            font-family: var(--font);
            color: var(--text);
        }
        
        textarea {
            height: 40px;
            padding: 8px;
            resize: none;
            line-height: 1.3;
        }
        
        input:focus, textarea:focus { outline: 2px solid var(--green); outline-offset: -2px; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; }
        input[type=number] { -moz-appearance: textfield; }
        
        .unit { position: relative; }
        .unit span {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.5rem;
            color: var(--text3);
        }
        .unit input { padding-right: 20px; }
        
        .calc-field input {
            background: var(--green-light);
            color: var(--green-dark);
            font-weight: 600;
        }
        
        .result-field input {
            background: var(--green-light);
            color: var(--green-dark);
            font-weight: 600;
            text-align: right;
        }
        
        .section-photo {
            display: flex;
            gap: 10px;
            align-items: flex-start;
            border: none;
        }
        
        .photo-col {
            flex-shrink: 0;
            width: var(--photo-size);
        }
        
        .photo-box {
            width: var(--photo-size);
            height: var(--photo-size);
            border-radius: 8px;
            overflow: hidden;
            background: var(--bg);
            position: relative;
            border: none;
        }
        .photo-box img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover;
        }
        .photo-box .del {
            position: absolute;
            top: 3px;
            right: 3px;
            width: 18px;
            height: 18px;
            background: rgba(0,0,0,0.6);
            border: none;
            border-radius: 50%;
            color: #FFF;
            font-size: 11px;
            cursor: pointer;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .photo-placeholder {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: transparent;
            border: 1.5px solid #D1D1D6;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .photo-placeholder:hover {
            border-color: var(--green);
            background: var(--green-light);
        }
        .photo-placeholder span {
            font-size: 14px;
            color: #C7C7CC;
            font-weight: 300;
            line-height: 1;
        }
        .photo-placeholder:hover span {
            color: var(--green);
        }
        
        .fields-wrap {
            flex: 1;
            min-width: 0;
        }
        
        .result {
            background: linear-gradient(180deg, var(--green-dark), #14332B);
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 6px;
            page-break-inside: avoid;
            break-inside: avoid;
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
        }
        
        .result-item {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 8px 4px;
            text-align: center;
        }
        
        .result-main {
            grid-column: 1 / -1;
            background: var(--green);
            margin-top: 6px;
            padding: 12px;
        }
        
        .result-item small {
            display: block;
            font-size: 0.45rem;
            color: rgba(255,255,255,0.6);
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        .result-item .val { 
            font-size: 0.9rem; 
            font-weight: 700; 
            color: #FFF;
            margin-top: 2px;
        }
        .result-main .val { font-size: 1.3rem; }
        .result-item .un { font-size: 0.4rem; color: rgba(255,255,255,0.5); }
        
        .toggle {
            background: none;
            border: none;
            color: rgba(255,255,255,0.5);
            font-size: 0.45rem;
            cursor: pointer;
            margin-top: 6px;
            padding: 4px 8px;
        }
        
        .details {
            display: none;
            margin-top: 6px;
            padding-top: 6px;
            border-top: 1px solid rgba(255,255,255,0.15);
            font-size: 0.45rem;
        }
        .details.show { display: block; }
        .details div { 
            display: flex; 
            justify-content: space-between; 
            padding: 2px 0; 
            color: rgba(255,255,255,0.5); 
        }
        .details span:last-child { color: rgba(255,255,255,0.85); font-weight: 500; }
        
        .photo-gallery {
            background: var(--card);
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 6px;
            page-break-inside: avoid;
            break-inside: avoid;
        }
        
        .photo-gallery-head {
            font-size: 0.55rem;
            font-weight: 600;
            color: var(--text2);
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 8px;
        }
        
        .photo-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .photo-item {
            width: 100%;
            aspect-ratio: 4/3;
            border-radius: 10px;
            overflow: hidden;
            background: var(--bg);
            position: relative;
            page-break-inside: avoid;
            break-inside: avoid;
        }
        
        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: var(--bg);
        }
        
        .photo-note {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border: none;
            padding: 6px 8px;
            font-size: 0.5rem;
            font-family: var(--font);
            color: var(--text);
            resize: none;
            outline: none;
        }
        
        .photo-note::placeholder {
            color: var(--text3);
        }
        
        .photo-note:focus {
            background: rgba(255, 255, 255, 0.95);
        }
        
        .photo-item .del-photo {
            position: absolute;
            top: 6px;
            right: 6px;
            width: 20px;
            height: 20px;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(8px);
            border: none;
            border-radius: 50%;
            color: #FFF;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .photo-item .del-photo:hover {
            background: #FF3B30;
            transform: scale(1.1);
        }
        
        .photo-add {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 1.5px dashed #D1D1D6;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
            page-break-inside: avoid;
            break-inside: avoid;
        }
        
        .photo-add:hover {
            border-color: var(--green);
            background: var(--green-light);
            transform: scale(1.05);
        }
        
        .photo-add-icon {
            font-size: 18px;
            color: var(--text3);
            line-height: 1;
            transition: all 0.2s;
        }
        
        .photo-add:hover .photo-add-icon {
            color: var(--green);
        }
        
        .footer {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--card);
            border-radius: 10px;
            padding: 8px 10px;
            margin-bottom: 6px;
            page-break-inside: avoid;
            break-inside: avoid;
        }
        
        .footer-logo {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: var(--bg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            overflow: hidden;
            font-size: 0.4rem;
            color: var(--text3);
        }
        .footer-logo img { width: 100%; height: 100%; object-fit: contain; }
        .footer-info { flex: 1; }
        .footer-info input { height: 22px; font-size: 0.65rem; margin-bottom: 3px; }
        .footer-info input:last-child { margin-bottom: 0; }
        
        .branding {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            padding: 8px;
            font-size: 0.5rem;
        }
        .branding-link {
            background: var(--card);
            border-radius: 8px;
            padding: 6px 8px;
            text-align: center;
            text-decoration: none;
            color: var(--text);
            transition: all 0.2s;
            border: 1px solid #E5E5EA;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 50px;
        }
        .branding-link:hover {
            border-color: var(--green);
            background: var(--green-light);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(52, 199, 89, 0.2);
        }
        .brand-solo { color: var(--text); font-weight: 600; }
        .brand-forte { color: var(--green); font-weight: 600; }
        .branding-link .icon {
            font-size: 1.2rem;
            margin-bottom: 2px;
        }
        .branding-link .title {
            font-weight: 600;
            font-size: 0.55rem;
            color: var(--text);
        }
        .branding-link small {
            display: block;
            font-size: 0.4rem;
            color: var(--text3);
            margin-top: 1px;
        }
        
        .fabs {
            position: fixed;
            bottom: 12px;
            right: 10px;
            display: flex;
            gap: 8px;
        }
        .fab {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(0,0,0,0.15);
            transition: transform 0.2s;
        }
        .fab:active { transform: scale(0.95); }
        .fab-w { background: #FFF; }
        .fab-w svg { width: 18px; height: 18px; fill: var(--text2); }
        .fab-g { background: var(--green); }
        .fab-g svg { width: 18px; height: 18px; fill: #FFF; }
        
        .loading {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            z-index: 999;
        }
        .loading.show { display: flex; }
        .loading-box {
            background: #FFF;
            padding: 24px 32px;
            border-radius: 14px;
            text-align: center;
        }
        .loading-box p { font-size: 0.8rem; color: var(--text); margin-top: 10px; }
        .spinner {
            width: 32px;
            height: 32px;
            border: 3px solid var(--bg);
            border-top-color: var(--green);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Estilos PDF - Imagens maiores, melhor qualidade */
        .pdf-mode {
            --photo-size: 100px;
        }
        .pdf-mode body {
            background: #FFF;
        }
        .pdf-mode .container {
            max-width: 100%;
            padding: 0;
            background: #FFF;
            margin: 0;
        }
        .pdf-mode .pdf-content {
            padding: 8px;
            background: #FFF;
        }
        
        /* Remover bordas divis√≥rias no PDF - manter apenas backgrounds para separa√ß√£o visual */
        .pdf-mode .card,
        .pdf-mode .aviso,
        .pdf-mode .result,
        .pdf-mode .footer,
        .pdf-mode .photo-gallery,
        .pdf-mode .photo-item,
        .pdf-mode .plant-card,
        .pdf-mode .result-box,
        .pdf-mode input,
        .pdf-mode select,
        .pdf-mode textarea,
        .pdf-mode .field,
        .pdf-mode .vagem-row,
        .pdf-mode .photo-box,
        .pdf-mode hr {
            border: none !important;
            box-shadow: none !important;
            outline: none !important;
        }
        
        /* Remover linhas horizontais e separadores */
        .pdf-mode .plant-header,
        .pdf-mode .plant-total,
        .pdf-mode .entrenos-row {
            border-top: none !important;
            border-bottom: none !important;
        }
        
        .pdf-mode .card {
            border-radius: 12px;
            margin-bottom: 4px;
            page-break-inside: avoid;
            overflow: visible;
        }
        .pdf-mode .card-head {
            padding: 6px 12px 3px;
            font-size: 0.6rem;
        }
        .pdf-mode .card-body {
            padding: 4px 12px 8px;
        }
        .pdf-mode .grid-2 {
            gap: 8px;
            margin-bottom: 6px;
        }
        .pdf-mode .aviso {
            border-radius: 0 10px 10px 0;
            margin-bottom: 4px;
            padding: 8px 12px;
            page-break-inside: avoid;
        }
        .pdf-mode .aviso-title {
            font-size: 0.65rem;
        }
        .pdf-mode .aviso-text {
            font-size: 0.55rem;
        }
        .pdf-mode .result {
            border-radius: 12px;
            margin-bottom: 4px;
            padding: 10px;
            page-break-inside: avoid;
        }
        .pdf-mode .footer {
            border-radius: 12px;
            margin-bottom: 4px;
            padding: 8px 12px;
            page-break-inside: avoid;
        }
        .pdf-mode .footer-logo {
            width: 50px;
            height: 50px;
        }
        .pdf-mode .photo-gallery {
            border-radius: 12px;
            margin-bottom: 4px;
            padding: 10px;
            page-break-inside: avoid;
        }
        
        .pdf-mode .photo-gallery-head {
            font-size: 0.6rem;
            margin-bottom: 6px;
        }
        
        .pdf-mode .photo-list {
            gap: 4px;
        }
        
        .pdf-mode .photo-item {
            border-radius: 12px;
        }
        
        .pdf-mode .photo-note {
            font-size: 0.55rem;
            padding: 8px 10px;
            background: rgba(255, 255, 255, 0.95);
        }
        
        .pdf-mode .photo-add {
            width: 40px;
            height: 40px;
        }
        
        .pdf-mode .photo-add-icon {
            font-size: 20px;
        }
        
        .pdf-mode .branding {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            padding: 12px;
            background: transparent;
            page-break-inside: avoid;
        }
        .pdf-mode .branding-link {
            background: var(--green-dark);
            color: #FFF;
            border: 2px solid rgba(255,255,255,0.1);
            padding: 10px;
            min-height: 60px;
        }
        .pdf-mode .branding-link .icon {
            font-size: 1.4rem;
            margin-bottom: 3px;
        }
        .pdf-mode .branding-link .title {
            color: #FFF;
            font-size: 0.6rem;
        }
        .pdf-mode .brand-solo {
            color: #FFF;
        }
        .pdf-mode .brand-forte {
            color: var(--green);
        }
        .pdf-mode .branding-link small {
            color: rgba(255,255,255,0.6);
            font-size: 0.45rem;
        }
        .pdf-mode .grid-2 {
            gap: 8px;
            margin-bottom: 6px;
        }
        .pdf-mode input, .pdf-mode textarea {
            height: 32px;
            font-size: 0.8rem;
            padding: 0 10px;
        }
        .pdf-mode textarea {
            height: 50px;
            padding: 10px;
        }
        .pdf-mode label {
            font-size: 0.58rem;
            margin-bottom: 3px;
        }
        .pdf-mode .section-photo {
            gap: 12px;
        }
        .pdf-mode .photo-col {
            width: 100px;
        }
        .pdf-mode .photo-box {
            width: 100px;
            height: 100px;
            border-radius: 10px;
        }
        .pdf-mode .result-item .val {
            font-size: 1rem;
        }
        .pdf-mode .result-main .val {
            font-size: 1.5rem;
        }
        
        @media print {
            .fabs, .header { display: none !important; }
            .details { display: block !important; }
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>Estimativa de Produ√ß√£o ‚Äî Soja</h1>
    </header>

    <div class="container">
        <main class="pdf-content" id="content">
            <div class="aviso">
                <div class="aviso-title">üìå Expectativa de Produ√ß√£o (Estimativa T√©cnica)</div>
                <div class="aviso-text">üì¢ Os n√∫meros s√£o proje√ß√µes t√©cnicas e n√£o garantem resultados absolutos, sujeitos a varia√ß√µes clim√°ticas, de manejo e campo.</div>
            </div>
            
            <section class="card">
                <div class="card-head">Identifica√ß√£o</div>
                <div class="card-body">
                    <div class="grid-2">
                        <div class="field"><label>Produtor</label><input type="text" id="produtor" placeholder="‚Äî"></div>
                        <div class="field"><label>Fazenda</label><input type="text" id="fazenda" placeholder="‚Äî"></div>
                    </div>
                    <div class="grid-2">
                        <div class="field"><label>Cidade/UF</label><input type="text" id="cidade" placeholder="‚Äî"></div>
                        <div class="field"><label>Cultivar</label><input type="text" id="cultivar" placeholder="‚Äî"></div>
                    </div>
                    <div class="grid-2">
                        <div class="field unit"><label>√Årea</label><input type="number" id="area" placeholder="‚Äî" step="0.1"><span>ha</span></div>
                        <div class="field"><label>Data</label><input type="date" id="data"></div>
                    </div>
                </div>
            </section>
            
            <section class="card">
                <div class="card-head">Popula√ß√£o</div>
                <div class="card-body">
                    <div class="grid-2">
                        <div class="field"><label>Plantas/Metro</label><input type="number" id="plantasMetro" placeholder="‚Äî" step="0.1"></div>
                        <div class="field unit"><label>Espa√ßamento</label><input type="number" id="espacamento" value="0.5" step="0.05"><span>m</span></div>
                    </div>
                    <div class="grid-2">
                        <div class="field calc-field"><label>Plantas/ha</label><input type="text" id="plantasHa" readonly></div>
                        <div class="field"></div>
                    </div>
                </div>
            </section>
            
            <section class="card">
                <div class="card-head">Componentes de Rendimento</div>
                <div class="card-body">
                    <div class="comp-layout">
                        <!-- Coluna Esquerda: Inputs -->
                        <div class="comp-inputs">
                            <div class="grid-2" style="margin-bottom: 8px;">
                                <div class="field">
                                    <label>Plantas Avaliadas</label>
                                    <input type="number" id="plantasAval" value="3" min="1" max="10">
                                </div>
                                <div class="field">
                                    <label>Modo de Contagem</label>
                                    <select id="modoContagem" style="width: 100%; height: 28px; border: 1px solid #D1D1D6; border-radius: 6px; padding: 0 8px; font-size: 0.65rem; font-family: var(--font); background: var(--bg);">
                                        <option value="individual">Individual</option>
                                        <option value="unica">Contagem √∫nica</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div id="plantasContainer" style="margin-top: 8px;"></div>
                            
                            <div class="field" style="margin-top: 8px;">
                                <label>PMG</label>
                                <div class="unit">
                                    <input type="number" id="pmg" placeholder="‚Äî" step="0.1">
                                    <span>g</span>
                                </div>
                            </div>
                            
                            <div class="field">
                                <label>Perdas</label>
                                <div class="unit">
                                    <input type="number" id="perdas" value="20">
                                    <span>%</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Coluna Direita: Resultados -->
                        <div class="comp-results">
                            <div class="result-box">
                                <label>Vagens/Planta</label>
                                <div class="result-value" id="vagens">‚Äî</div>
                            </div>
                            
                            <div class="result-box">
                                <label>Gr√£os/Vagem</label>
                                <div class="result-value" id="graos">‚Äî</div>
                            </div>
                            
                            <div class="result-box highlight">
                                <label>Gr√£os/Planta</label>
                                <div class="result-value" id="rGraosPl">‚Äî</div>
                            </div>
                            
                            <div class="result-box highlight">
                                <label>g/Planta</label>
                                <div class="result-value" id="rGramasPl">‚Äî</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <section class="card">
                <div class="card-head">Observa√ß√µes</div>
                <div class="card-body">
                    <textarea id="anotacaoGeral" placeholder="Anota√ß√µes gerais sobre a avalia√ß√£o..."></textarea>
                </div>
            </section>
            
            <section class="result">
                <div class="result-grid">
                    <div class="result-item"><small>kg/ha</small><div class="val" id="rKg">‚Äî</div></div>
                    <div class="result-item"><small>Bruto</small><div class="val" id="rBruto">‚Äî</div><div class="un">sc/ha</div></div>
                    <div class="result-item"><small>L√≠quido</small><div class="val" id="rLiqItem">‚Äî</div><div class="un">sc/ha</div></div>
                    <div class="result-item result-main"><small>Produ√ß√£o Estimada</small><div class="val" id="rLiquido">‚Äî</div><div class="un">sacas/ha</div></div>
                </div>
                <button class="toggle" onclick="toggleDetails()">‚ñº Detalhes do c√°lculo</button>
                <div class="details" id="details">
                    <div><span>Gr√£os/planta</span><span id="d1">‚Äî</span></div>
                    <div><span>Gramas/planta</span><span id="d2">‚Äî</span></div>
                    <div><span>kg/ha</span><span id="d3">‚Äî</span></div>
                    <div><span>Sacas bruto</span><span id="d4">‚Äî</span></div>
                    <div><span>Sacas l√≠quido</span><span id="d5">‚Äî</span></div>
                </div>
            </section>
            
            <section class="photo-gallery">
                <div class="photo-gallery-head">Fotos da Avalia√ß√£o</div>
                <div class="photo-list" id="photoList"></div>
            </section>
            
            <section class="footer">
                <div class="footer-logo" onclick="document.getElementById('logoInput').click()" id="logoBox">Logo</div>
                <div class="footer-info">
                    <input type="text" id="editorNome" placeholder="Respons√°vel t√©cnico">
                    <input type="text" id="editorContato" placeholder="Contato / CREA">
                </div>
            </section>
            
            <div class="branding">
                <a href="https://afonsoraudinei.github.io/Calculadorasoja/" target="_blank" class="branding-link">
                    <div class="icon">üå±</div>
                    <div class="title"><span class="brand-solo">Solo</span><span class="brand-forte">Forte</span></div>
                    <small>Nova estimativa</small>
                </a>
                <a href="https://afonsoraudinei.github.io/Relat-rio-/" target="_blank" class="branding-link">
                    <div class="icon">üìã</div>
                    <div class="title">Avalia√ß√£o</div>
                    <small>Relat√≥rio completo</small>
                </a>
                <a href="https://afonsoraudinei.github.io/ocorrencia/" target="_blank" class="branding-link">
                    <div class="icon">‚ö†Ô∏è</div>
                    <div class="title">Ocorr√™ncia</div>
                    <small>Registrar problema</small>
                </a>
                <a href="https://afonsoraudinei.github.io/Planejamento/" target="_blank" class="branding-link">
                    <div class="icon">üìÖ</div>
                    <div class="title">Planejamento</div>
                    <small>Agenda semanal</small>
                </a>
            </div>
        </main>
    </div>

    <div class="fabs" id="fabs">
        <button class="fab fab-w" onclick="limpar()" title="Limpar"><svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></button>
        <button class="fab fab-g" onclick="exportPDF()" title="Exportar PDF"><svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg></button>
    </div>

    <div class="loading" id="loading">
        <div class="loading-box">
            <div class="spinner"></div>
            <p>Gerando PDF...</p>
        </div>
    </div>

    <input type="file" id="fileInput" accept="image/*" hidden>
    <input type="file" id="logoInput" accept="image/*" hidden>

    <script>
        let photos = JSON.parse(localStorage.getItem('soja_photos_gallery')) || [];
        let logo = localStorage.getItem('soja_logo') || null;
        let plants = JSON.parse(localStorage.getItem('soja_plants')) || [];
        let modoContagem = localStorage.getItem('soja_modo_contagem') || 'individual';
        
        const fields = ['produtor','fazenda','cidade','cultivar','area','data','plantasMetro','espacamento','plantasAval','pmg','perdas','editorNome','editorContato','anotacaoGeral'];
        
        // Migrar dados antigos se necess√°rio
        if (photos.length > 0 && typeof photos[0] === 'string') {
            photos = photos.map(img => ({ image: img, note: '' }));
            localStorage.setItem('soja_photos_gallery', JSON.stringify(photos));
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            renderGallery();
            renderLogo();
            
            // Carregar modo de contagem
            document.getElementById('modoContagem').value = modoContagem;
            
            renderPlants();
            calc();
            if (!document.getElementById('data').value) {
                document.getElementById('data').valueAsDate = new Date();
            }
            
            // Listener para modo de contagem
            document.getElementById('modoContagem').addEventListener('change', (e) => {
                modoContagem = e.target.value;
                localStorage.setItem('soja_modo_contagem', modoContagem);
                adjustPlantsCount(parseInt(document.getElementById('plantasAval').value) || 3);
            });
            
            // Listener para mudar n√∫mero de plantas
            document.getElementById('plantasAval').addEventListener('input', (e) => {
                const num = parseInt(e.target.value) || 0;
                adjustPlantsCount(num);
                saveData();
            });
        });
        
        function adjustPlantsCount(targetCount) {
            if (targetCount < 1) targetCount = 1;
            if (targetCount > 10) targetCount = 10;
            
            if (modoContagem === 'unica') {
                // Modo √∫nico: apenas 1 card para preencher
                if (plants.length === 0 || !plants[0]) {
                    plants = [{ v4: 0, v3: 0, v2: 0, v1: 0, entrenos: 0 }];
                }
            } else {
                // Modo individual: um card por planta
                // Adicionar plantas se necess√°rio
                while (plants.length < targetCount) {
                    plants.push({ v4: 0, v3: 0, v2: 0, v1: 0, entrenos: 0 });
                }
                
                // Remover plantas excedentes
                if (plants.length > targetCount) {
                    plants = plants.slice(0, targetCount);
                }
            }
            
            savePlants();
            renderPlants();
            calc();
        }
        
        function renderPlants() {
            const container = document.getElementById('plantasContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            const numPlantas = parseInt(document.getElementById('plantasAval').value) || 1;
            
            if (modoContagem === 'unica') {
                // Modo √∫nico: APENAS 1 CARD independente do n√∫mero de plantas
                const plant = plants[0] || { v4: 0, v3: 0, v2: 0, v1: 0, entrenos: 0 };
                
                const v4Total = (plant.v4 || 0) * 4;
                const v3Total = (plant.v3 || 0) * 3;
                const v2Total = (plant.v2 || 0) * 2;
                const v1Total = (plant.v1 || 0) * 1;
                const totalGraos = v4Total + v3Total + v2Total + v1Total;
                const totalVagens = (plant.v4 || 0) + (plant.v3 || 0) + (plant.v2 || 0) + (plant.v1 || 0);
                
                const card = document.createElement('div');
                card.className = 'plant-card';
                
                card.innerHTML = `
                    <div class="plant-header">Contagem √önica (${numPlantas} ${numPlantas === 1 ? 'planta' : 'plantas'})</div>
                    
                    <div class="vagem-row">
                        <label>4 gr√£os</label>
                        <input type="number" inputmode="numeric" min="0" value="${plant.v4 || 0}" onchange="updatePlant(0, 'v4', this.value)">
                        <div class="vagem-result">${v4Total}</div>
                    </div>
                    
                    <div class="vagem-row">
                        <label>3 gr√£os</label>
                        <input type="number" inputmode="numeric" min="0" value="${plant.v3 || 0}" onchange="updatePlant(0, 'v3', this.value)">
                        <div class="vagem-result">${v3Total}</div>
                    </div>
                    
                    <div class="vagem-row">
                        <label>2 gr√£os</label>
                        <input type="number" inputmode="numeric" min="0" value="${plant.v2 || 0}" onchange="updatePlant(0, 'v2', this.value)">
                        <div class="vagem-result">${v2Total}</div>
                    </div>
                    
                    <div class="vagem-row">
                        <label>1 gr√£o</label>
                        <input type="number" inputmode="numeric" min="0" value="${plant.v1 || 0}" onchange="updatePlant(0, 'v1', this.value)">
                        <div class="vagem-result">${v1Total}</div>
                    </div>
                    
                    <div class="entrenos-row">
                        <label>Entren√≥s/planta (opcional)</label>
                        <input type="number" inputmode="numeric" min="0" value="${plant.entrenos || ''}" onchange="updatePlant(0, 'entrenos', this.value)" placeholder="‚Äî">
                    </div>
                    
                    <div class="plant-total">
                        <div class="plant-total-label">${totalVagens} vagens</div>
                        <div class="plant-total-value">${totalGraos} gr√£os</div>
                    </div>
                `;
                
                container.appendChild(card);
                
            } else {
                // Modo individual: UM CARD POR PLANTA
                plants.forEach((plant, index) => {
                    const v4Total = (plant.v4 || 0) * 4;
                    const v3Total = (plant.v3 || 0) * 3;
                    const v2Total = (plant.v2 || 0) * 2;
                    const v1Total = (plant.v1 || 0) * 1;
                    const totalGraos = v4Total + v3Total + v2Total + v1Total;
                    const totalVagens = (plant.v4 || 0) + (plant.v3 || 0) + (plant.v2 || 0) + (plant.v1 || 0);
                    
                    const card = document.createElement('div');
                    card.className = 'plant-card';
                    
                    card.innerHTML = `
                        <div class="plant-header">Planta ${index + 1}</div>
                        
                        <div class="vagem-row">
                            <label>4 gr√£os</label>
                            <input type="number" inputmode="numeric" min="0" value="${plant.v4 || 0}" onchange="updatePlant(${index}, 'v4', this.value)">
                            <div class="vagem-result">${v4Total}</div>
                        </div>
                        
                        <div class="vagem-row">
                            <label>3 gr√£os</label>
                            <input type="number" inputmode="numeric" min="0" value="${plant.v3 || 0}" onchange="updatePlant(${index}, 'v3', this.value)">
                            <div class="vagem-result">${v3Total}</div>
                        </div>
                        
                        <div class="vagem-row">
                            <label>2 gr√£os</label>
                            <input type="number" inputmode="numeric" min="0" value="${plant.v2 || 0}" onchange="updatePlant(${index}, 'v2', this.value)">
                            <div class="vagem-result">${v2Total}</div>
                        </div>
                        
                        <div class="vagem-row">
                            <label>1 gr√£o</label>
                            <input type="number" inputmode="numeric" min="0" value="${plant.v1 || 0}" onchange="updatePlant(${index}, 'v1', this.value)">
                            <div class="vagem-result">${v1Total}</div>
                        </div>
                        
                        <div class="entrenos-row">
                            <label>Entren√≥s/planta (opcional)</label>
                            <input type="number" inputmode="numeric" min="0" value="${plant.entrenos || ''}" onchange="updatePlant(${index}, 'entrenos', this.value)" placeholder="‚Äî">
                        </div>
                        
                        <div class="plant-total">
                            <div class="plant-total-label">${totalVagens} vagens</div>
                            <div class="plant-total-value">${totalGraos} gr√£os</div>
                        </div>
                    `;
                    
                    container.appendChild(card);
                });
            }
        }
        
        function updatePlant(index, field, value) {
            plants[index][field] = parseInt(value) || 0;
            savePlants();
            renderPlants();
            calc();
        }
        
        function savePlants() {
            localStorage.setItem('soja_plants', JSON.stringify(plants));
        }
        
        function renderGallery() {
            const list = document.getElementById('photoList');
            if (!list) return;
            
            list.innerHTML = '';
            
            // Mostrar fotos existentes (cada uma em linha cheia)
            photos.forEach((photo, index) => {
                const item = document.createElement('div');
                item.className = 'photo-item';
                item.innerHTML = `
                    <img src="${photo.image}">
                    <textarea class="photo-note" placeholder="Anota√ß√£o..." oninput="updateNote(${index}, this.value)">${photo.note || ''}</textarea>
                    <button class="del-photo" onclick="deletePhoto(${index})">√ó</button>
                `;
                list.appendChild(item);
            });
            
            // Mostrar bot√£o min√∫sculo de adicionar se tiver menos de 4 fotos
            if (photos.length < 4) {
                const addBtn = document.createElement('div');
                addBtn.className = 'photo-add';
                addBtn.onclick = () => document.getElementById('fileInput').click();
                addBtn.innerHTML = `<div class="photo-add-icon">+</div>`;
                list.appendChild(addBtn);
            }
        }
        
        function updateNote(index, value) {
            photos[index].note = value;
            localStorage.setItem('soja_photos_gallery', JSON.stringify(photos));
        }
        
        function loadData() {
            const d = JSON.parse(localStorage.getItem('soja_data')) || {};
            fields.forEach(id => { 
                const el = document.getElementById(id); 
                if (el && d[id]) el.value = d[id]; 
            });
        }
        
        function saveData() {
            const d = {};
            fields.forEach(id => { 
                const el = document.getElementById(id); 
                if (el) d[id] = el.value; 
            });
            localStorage.setItem('soja_data', JSON.stringify(d));
        }
        
        function calcPlantasHa() {
            const pm = parseFloat(document.getElementById('plantasMetro').value) || 0;
            const esp = parseFloat(document.getElementById('espacamento').value) || 0.5;
            if (pm && esp) {
                const pl = Math.round(pm * (10000 / esp));
                document.getElementById('plantasHa').value = pl.toLocaleString('pt-BR');
                return pl;
            }
            document.getElementById('plantasHa').value = '';
            return 0;
        }
        
        function calc() {
            const plantasHa = calcPlantasHa();
            const pmg = parseFloat(document.getElementById('pmg').value) || 0;
            const p = parseFloat(document.getElementById('perdas').value) || 0;
            
            // Calcular m√©dias das plantas avaliadas
            if (plants.length === 0) {
                document.getElementById('vagens').textContent = '‚Äî';
                document.getElementById('graos').textContent = '‚Äî';
                document.getElementById('rGraosPl').textContent = '‚Äî';
                document.getElementById('rGramasPl').textContent = '‚Äî';
                ['rKg','rBruto','rLiqItem','rLiquido'].forEach(id => document.getElementById(id).textContent = '‚Äî');
                ['d1','d2','d3','d4','d5'].forEach(id => document.getElementById(id).textContent = '‚Äî');
                return;
            }
            
            let totalVagens = 0;
            let totalGraos = 0;
            
            plants.forEach(plant => {
                const v = (plant.v4 || 0) + (plant.v3 || 0) + (plant.v2 || 0) + (plant.v1 || 0);
                const g = (plant.v4 || 0) * 4 + (plant.v3 || 0) * 3 + (plant.v2 || 0) * 2 + (plant.v1 || 0) * 1;
                totalVagens += v;
                totalGraos += g;
            });
            
            const vagensMedia = totalVagens / plants.length;
            const graosMedia = totalGraos / totalVagens || 0;
            const graosPorPlanta = totalGraos / plants.length;
            
            document.getElementById('vagens').textContent = vagensMedia.toFixed(1);
            document.getElementById('graos').textContent = graosMedia.toFixed(2);
            document.getElementById('rGraosPl').textContent = graosPorPlanta.toFixed(1);
            
            const gramasPl = graosPorPlanta * (pmg / 1000);
            document.getElementById('rGramasPl').textContent = gramasPl ? gramasPl.toFixed(2) : '‚Äî';
            
            if (!plantasHa || !pmg || totalGraos === 0) {
                ['rKg','rBruto','rLiqItem','rLiquido'].forEach(id => document.getElementById(id).textContent = '‚Äî');
                ['d1','d2','d3','d4','d5'].forEach(id => document.getElementById(id).textContent = '‚Äî');
                return;
            }
            
            const kgHa = (plantasHa * gramasPl) / 1000;
            const scB = kgHa / 60;
            const scL = scB * (1 - p / 100);
            
            document.getElementById('rKg').textContent = kgHa.toFixed(0);
            document.getElementById('rBruto').textContent = scB.toFixed(1);
            document.getElementById('rLiqItem').textContent = scL.toFixed(1);
            document.getElementById('rLiquido').textContent = scL.toFixed(2);
            
            document.getElementById('d1').textContent = `${vagensMedia.toFixed(1)} √ó ${graosMedia.toFixed(2)} = ${graosPorPlanta.toFixed(1)}`;
            document.getElementById('d2').textContent = `${graosPorPlanta.toFixed(1)} √ó ${(pmg/1000).toFixed(3)} = ${gramasPl.toFixed(2)}g`;
            document.getElementById('d3').textContent = `${gramasPl.toFixed(2)} √ó ${plantasHa.toLocaleString()} = ${kgHa.toFixed(0)}`;
            document.getElementById('d4').textContent = `${kgHa.toFixed(0)} √∑ 60 = ${scB.toFixed(2)} sc`;
            document.getElementById('d5').textContent = `${scB.toFixed(2)} √ó ${((100-p)/100).toFixed(2)} = ${scL.toFixed(2)} sc`;
            
            saveData();
        }
        
        function toggleDetails() {
            document.getElementById('details').classList.toggle('show');
        }
        
        fields.forEach(id => {
            const el = document.getElementById(id);
            if (el) el.addEventListener('input', () => { calc(); saveData(); });
        });
        
        function deletePhoto(index) {
            photos.splice(index, 1);
            localStorage.setItem('soja_photos_gallery', JSON.stringify(photos));
            renderGallery();
        }
        
        document.getElementById('fileInput').addEventListener('change', async e => {
            const f = e.target.files[0];
            if (!f) return;
            
            if (photos.length >= 4) {
                alert('M√°ximo de 4 fotos atingido');
                e.target.value = '';
                return;
            }
            
            try {
                // Compress√£o para boa qualidade
                const compressed = await compressImage(f, 1200, 0.90);
                photos.push({ image: compressed, note: '' });
                localStorage.setItem('soja_photos_gallery', JSON.stringify(photos));
                renderGallery();
            } catch (err) {
                console.error('Erro ao processar imagem:', err);
            }
            
            e.target.value = '';
        });
        
        function renderLogo() {
            const box = document.getElementById('logoBox');
            box.innerHTML = logo ? `<img src="${logo}">` : 'Logo';
        }
        
        document.getElementById('logoInput').addEventListener('change', async e => {
            const f = e.target.files[0];
            if (!f) return;
            
            try {
                logo = await compressImage(f, 200, 0.85);
                localStorage.setItem('soja_logo', logo);
                renderLogo();
            } catch (err) {
                console.error('Erro ao processar logo:', err);
            }
            
            e.target.value = '';
        });
        
        function compressImage(file, maxSize, quality) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let w = img.width;
                        let h = img.height;
                        
                        if (w > h) {
                            if (w > maxSize) {
                                h = Math.round(h * maxSize / w);
                                w = maxSize;
                            }
                        } else {
                            if (h > maxSize) {
                                w = Math.round(w * maxSize / h);
                                h = maxSize;
                            }
                        }
                        
                        canvas.width = w;
                        canvas.height = h;
                        
                        const ctx = canvas.getContext('2d');
                        ctx.imageSmoothingEnabled = true;
                        ctx.imageSmoothingQuality = 'high';
                        ctx.drawImage(img, 0, 0, w, h);
                        
                        resolve(canvas.toDataURL('image/jpeg', quality));
                    };
                    img.onerror = reject;
                    img.src = e.target.result;
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        function limpar() {
            if (confirm('Limpar todos os dados?')) {
                localStorage.removeItem('soja_data');
                localStorage.removeItem('soja_photos_gallery');
                localStorage.removeItem('soja_logo');
                localStorage.removeItem('soja_plants');
                location.reload();
            }
        }
        
        async function exportPDF() {
            const loading = document.getElementById('loading');
            const fabs = document.getElementById('fabs');
            const details = document.getElementById('details');
            const content = document.getElementById('content');
            
            loading.classList.add('show');
            fabs.style.display = 'none';
            details.classList.add('show');
            
            // Ativar modo PDF
            document.body.classList.add('pdf-mode');
            
            // Esconder bot√µes de deletar e adicionar foto
            document.querySelectorAll('.del-photo, .photo-add').forEach(el => {
                el.style.display = 'none';
            });
            
            try {
                await new Promise(r => setTimeout(r, 400));
                
                // Capturar todo o conte√∫do de uma vez em alta resolu√ß√£o
                const canvas = await html2canvas(content, {
                    scale: 2.8,
                    useCORS: true,
                    backgroundColor: '#FFFFFF',
                    logging: false,
                    imageTimeout: 0,
                    allowTaint: true,
                    windowHeight: content.scrollHeight
                });
                
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                const pageWidth = 210;
                const pageHeight = 297;
                const margin = 5;
                const contentWidth = pageWidth - (margin * 2);
                const contentHeight = pageHeight - (margin * 2);
                
                const imgData = canvas.toDataURL('image/jpeg', 0.93);
                const imgWidth = contentWidth;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                // Calcular quantas p√°ginas s√£o necess√°rias
                const totalPages = Math.ceil(imgHeight / contentHeight);
                
                // Adicionar cada p√°gina
                for (let page = 0; page < totalPages; page++) {
                    if (page > 0) {
                        pdf.addPage();
                    }
                    
                    const yOffset = -(page * contentHeight);
                    
                    pdf.addImage(
                        imgData, 
                        'JPEG', 
                        margin, 
                        margin + yOffset, 
                        imgWidth, 
                        imgHeight,
                        undefined,
                        'FAST'
                    );
                }
                
                // Adicionar links clic√°veis na √∫ltima p√°gina
                pdf.setPage(totalPages);
                
                // Calcular posi√ß√£o dos links (√∫ltimos elementos)
                const linkHeight = 12;
                const bottomMargin = 30;
                const linkY = pageHeight - bottomMargin;
                const linkWidth = (contentWidth - 4) / 2;
                
                const links = [
                    { url: 'https://afonsoraudinei.github.io/Calculadorasoja/', x: margin, y: linkY },
                    { url: 'https://afonsoraudinei.github.io/Relat-rio-/', x: pageWidth/2 + 1, y: linkY },
                    { url: 'https://afonsoraudinei.github.io/ocorrencia/', x: margin, y: linkY + linkHeight + 2 },
                    { url: 'https://afonsoraudinei.github.io/Planejamento/', x: pageWidth/2 + 1, y: linkY + linkHeight + 2 }
                ];
                
                links.forEach(link => {
                    pdf.link(link.x, link.y, linkWidth - 2, linkHeight, { url: link.url });
                });
                
                const fileName = `estimativa-soja-${new Date().toISOString().slice(0,10)}.pdf`;
                pdf.save(fileName);
                
            } catch (err) {
                console.error('Erro ao gerar PDF:', err);
                alert('Erro ao gerar PDF. Tente novamente.');
            } finally {
                document.body.classList.remove('pdf-mode');
                
                document.querySelectorAll('.del-photo, .photo-add').forEach(el => {
                    el.style.display = '';
                });
                fabs.style.display = 'flex';
                loading.classList.remove('show');
                details.classList.remove('show');
            }
        }
    </script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
    </script>
</body>
</html>
